<!DOCTYPE html>

<html lang="en" xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorate="layout/layout"
      xmlns="http://www.w3.org/1999/html">
<head>
    <title>Appearance Form</title>
</head>
<body>

<div layout:fragment="content">

   <script th:inline="javascript">
    var purposes = /*[[${purposes}]]*/'novalue';

    $(document).ready(function(){

       // $("td:nth-child(1),th:nth-child(1)").hide();

        $("#editAppearancePurpose").autocomplete({
            minLength : 4,
            source : purposes
        });

        $("#searchPurpose").autocomplete({
            minLength : 1,
            source : purposes
        });
    });
   </script>




<div class="col-lg-8 col-md-8 text-light align-self-center container-fluid my-5 py-4 bg-dark" style="border-radius: 10px;">
    <div class="container mb-4">
        <a th:href="@{/visitors}" class="link-primary"><i class="fa-solid fa-arrow-left-long"></i> Back</a>
    </div>

   <h5 class="text-dark-emphasis mb-2 ms-2" style=" font-family:Verdana, Geneva, Tahoma, sans-serif; font-weight : 700;">Appearance History of </h5>
    <div class="container">
        <div class="row mb-4">
            <div class="col-lg-12 col-md-12 col-sm-12">
               <h2 class="text-light" style=" font : 'Roboto Mono'; font-weight : 900; text-shadow: 2px 2px black;" th:text="${visitor.name}"></h2>
            </div>
            <div class="col">
                <h6 class="text-secondary mb-0"  th:text="${visitor.position}"></h6>
                <h6 class="text-secondary"  th:text="${visitor.agency}"></h6>
            </div>
             <div class="col">
                
            </div>
        </div>

        <div class="row mt-3">
            <div class="card p-0">
                <div class="card-header pt-3">
                    <div class="container text-center mt-6 pt-6">
                    <div class="row  mb-2">

                        <div class="col-md-2">
                            <select form="searchForm" name="selectedMonth" th:value = "${selectedMonth}" id ="month" class="border border-secondary form-control">
                                <option th:value="0" >Select Month</option>
                                <option th:each="month :${months}" th:value="${month.value}" th:text="${month.name}" th:selected="${month.value == selectedMonth}"></option>
                            </select>
                        </div>
                        <div class="col-md-2">
                            <select form="searchForm" name="selectedYear" th:value = "${selectedYear}" id ="year" class="border border-secondary form-control">
                                <option th:value="0" >Select Year</option>
                                <option th:each="year :${years}" th:value="${year}" th:text="${year}" th:selected="${year == selectedYear}"></option>
                            </select>
                        </div>

                        <div class="col-md-4 offset-md-1">
                            <form th:action="@{'/appearances/' + ${visitor.id} + '/appearance-history'}" id="searchForm">
                                <div class="row">
                                    <div class="col-8 p-0">
                                        <input id = "searchPurpose" type="search" name="searchPurpose" th:value="${searchPurpose}"
                                            placeholder="Enter purpose" required class="border border-secondary form-control">
                                    </div>
                                    <div class="col-auto  p-1 mt-auto">
                                        <button type="submit" class="btn-search btn btn-sm btn-primary"> <i class="fa fa-search"></i></button>
                                    </div>
                                </div>
                            </form>
                        </div>
                            <div class="col-md-1 offset-md-1">
                                <select form="searchForm" name="size" th:value="${pageSize}" id="pageSize" class="border border-secondary form-control">
                                    <option th:each="pageNum :${pageNums}" th:value="${pageNum}" th:text="${pageNum}" th:selected="${pageNum == pageSize}"></option>
                                </select>
                            </div>

                        <div class="btn-clear col-1 col-md-1 col-sm-1 mt-1">
                            <button  id="btnClear" class="btn btn-sm btn-secondary" th:visitorId="${visitor.id}">Clear</button>
                        </div>
                    </div>
                </div>
                </div>

                <div class="card-body">
                    <div class="mb-1"> <button id="btnPrintChecked" class="btn btn-sm btn-success" style="display:none;">Print</button> </div>
                    <div th:if="${appearances.size() > 0}">
                            <form id="appearances" th:action="@{/appearances/print(visitorId=${visitorId})}" method="post" th:object="${idList}">
                            <table class="table table-striped table-responsive-xl">
                                <thead class="table-dark">
                                <tr>
                                    <th scope="col"> </th>
    <!--                            <th th:replace="/fragments/appearance/sorting :: sorting(id, No)"></th>-->
                                    <th th:replace="fragments/appearance/sorting :: sorting(dateIssued,'Date Issued')"></th>
                                    <th th:replace="fragments/appearance/sorting :: sorting(dateFrom,'From')"></th>
                                    <th th:replace="fragments/appearance/sorting :: sorting(dateTo,'To')"></th>
                                    <th th:replace="fragments/appearance/sorting :: sorting(purpose,'Purpose')"></th>
                                    <th scope="col">Actions</th>
                                </tr>
                                </thead>
                                <tbody>
                                    <tr role = "row" th:each="appearance : ${appearances}">

                                        <td>
                                            <input class="chk-print" type="checkbox" th:field="*{appearanceIDs}" th:value="${appearance.id}">
                                        </td>
                                        <td th:text="${appearance.dateIssued}"></td>
                                        <td th:text="${appearance.dateFrom}"></td>
                                        <td th:text="${appearance.dateTo}"></td>
                                        <td th:text="${appearance.purpose}"></td>
                                        <td>

                                            <a type="button" title="Edit this appearance" class="btn-edit btn btn-sm btn-warning"
                                            th:appearanceId="${appearance.id}"
                                            th:appearanceDateIssued="${appearance.dateIssued}"
                                            th:appearanceDateFrom = "${appearance.dateFrom}"
                                            th:appearanceDateTo="${appearance.dateTo}"
                                            th:appearancePurpose="${appearance.purpose}">
                                            <i class="fa-solid fa-pen-to-square"></i>
                                            </a>

                                            <a type="button" class= "btn btn-sm btn-success" th:href="@{/appearances/certificate(appearance=${appearance.id})}" id="printAppearanceButton"
                                            title="Print Appearance"><i class="fa-solid fa-print"></i></a>

                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                            </form>
                    </div>

                <div th:unless ="${appearances.size() > 0}">
                    <div class=" no-record alert alert-dark text-center" role="alert">No records found</div>
                </div>
            </div>

            <div class="card-footer pt-3 pb-0">
            <!--Pagination-->
            <nav aria-label="Pagination" th:if="${totalPages > 0}">
                <ul class="pagination justify-content-center">

                    <li class="page-item" th:classapend="${currentPage == 1} ? 'disabled'">
                        <a th:replace="fragments/appearance/paging :: paging(1,'<<', 'First Page')"></a>
                    </li>

                    <li class="page-item font-weight-bold" th:classappend="${currentPage == 1} ? 'disabled'">
                        <a th:replace="fragments/appearance/paging :: paging(${currentPage - 1}, 'Prev','Previous Page')"></a>
                    </li>

                    <li class="page-item disabled" th:if="${currentPage - 4 > 1}">
                        <a class="page-link" href="#">...</a>
                    </li>

                    <li class="page-item" th:classappend="${page == currentPage} ? 'active'"
                        th:each ="page : ${#numbers.sequence(currentPage > 4 ? currentPage - 4 : 1, currentPage + 4 < totalPages ? currentPage + 4 : totalPages)}">
                        <a th:replace="fragments/appearance/paging :: paging(${page}, ${page}, 'Page')"></a>
                    </li>

                    <li class="page-item disabled" th:if="${currentPage + 4 < totalPages}">
                        <a class="page-link" href="#">...</a>
                    </li>

                    <li class="page-item" th:classappend="${currentPage == totalPages} ? 'disabled'">
                        <a th:replace="fragments/appearance/paging :: paging(${currentPage + 1},'Next', 'Next Page')"></a>
                    </li>

                    <li class ="page-item" th:classappend="${currentPage == totalPages} ? 'disabled'">
                        <a th:replace="fragments/appearance/paging :: paging(${totalPages}, '>>', 'Last Page')"></a>
                    </li>
                </ul>
            </nav>
            </div>

        </div>
        
    </div>
    </div>
    </div>

    <!-- Edit Appearance Modal -->
    <div  class="modal" data-bs-theme="dark" id="editAppearanceModal" role="dialog" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content ui-front">
                <div class="modal-header">
                    <h5 class="modal-title text-light">Edit Appearance</h5>
                    <button type="button" id="editModalCloseButton" class="btn-close" data-bs-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true"></span>
                    </button>
                </div>
                <form th:action="@{/appearances/update}" method="POST"   th:object="${editFormAppearanceDTO}">
                    <span id="editModalMessageHolder" th:text="${editModalMessage}"></span>

                    <div class="modal-body">
                        <div class="col-xs-auto">
                            <!-- check for error -->
                            <div id="editModalDiv" th:if="${editModalMessage != null}">
                                <div class="alert alert-danger col-xs-auto">
                                    <span th:text="${editModalMessage}"></span>
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <input  type="hidden" th:field="*{id}" id="editAppearanceId">

                            <div class="md-form form-floating mb-3">
                                <input type="text" th:field="*{dateIssued}" class="form-control" id="editAppearanceDateIssued"
                                       placeholder="Date Issued">
                                <label class="text-secondary" for="editAppearanceDateIssued">Date Issued</label>
                            </div>
                        </div>

                        <div class="form-group">
                            <div class="md-form form-floating mb-3">
                                <input type="text" th:field="*{dateFrom}" class="form-control" id="editAppearanceDateFrom"
                                        placeholder="From">
                                <label class="text-secondary" for="editAppearanceDateFrom">From</label>
                            </div>
                        </div>

                        <div class="form-group">
                            <div class="md-form form-floating mb-3">
                                <input type="text" th:field="*{dateTo}" class=" form-control" id="editAppearanceDateTo"
                                       placeholder="To">
                                <label class="text-secondary" for="editAppearanceDateTo">To</label>
                            </div>
                        </div>

                        <div class="form-group">
                            <div class="md-form form-floating mb-3">
                                <textarea class="form-control" th:field="*{purpose}"  required minlength="5" maxlength="1000" placeholder="State the purpose of appearance here." id ="editAppearancePurpose"></textarea>
                                <label class="text-secondary" for ="editAppearancePurpose">Purpose</label>
                            </div>
                        </div>

                    </div>

                    <div class="modal-footer">
                        <div class="row">
                            <div class="col">
                                <button type="submit" name="save" value="SaveOnly" class="btn btn-primary">Save</button>
                            </div>

                            <div class="col-auto">
                                <button type="submit" name="save"  value="SaveAndPrint" class="btn btn-warning">Save and Print</button>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>


</div>
    <th:block layout:fragment="script">
        <script th:src="@{/js/appearance-history.js}" type="text/javascript"></script>
    </th:block>

</body>
</html>