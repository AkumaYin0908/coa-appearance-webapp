<!DOCTYPE html>
<html
  lang="en"
  xmlns:th="http://www.thymeleaf.org"
  xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
  layout:decorate="layout/layout">
  <head>
    <title>Dashboard</title>

    <link rel="stylesheet" th:href="@{/css/dashboard.css}" />
  </head>
  <body>
    <div layout:fragment="content">
      <script th:inline="javascript">
        var visitors = /*[[${visitors}]]*/ "novalue";
        var leaderNames = /*[[${leaderNames}]]*/ "novalue";
        var positions = /*[[${positions}]]*/ "novalue";
        var agencies = /*[[${agencies}]]*/ "novalue";

        $(document).ready(function () {
          $("#visitorPosition").autocomplete({
            minLength: 1,
            source: positions,
          });

          $("#visitorAgency").autocomplete({
            minLength: 1,
            source: agencies,
          });

          $("td:nth-child(1),th:nth-child(1)").hide();

          $("#searchText").autocomplete({
            minLength: 3,
            source: visitors,
          });

          $("#leaderName").autocomplete({
            minLength: 2,
            source: leaderNames,
          });
        });
      </script>

      <div class="mt-5">
        <div class="search-div card mt-5 mb-5 bg-secondary">
          <div class="card-body search-container">
            <form th:action="@{/dashboard}" class="search-bar">
              <input
                id="searchText"
                type="text"
                placeholder="Create new appearance for...."
                name="searchName"
                th:value="${searchName}" />
              <button type="submit" name="direction" value="dashboard">
                <span class="material-symbols-outlined">search</span>
              </button>
            </form>
          </div>
        </div>

        <div class="card">
          <div class="card-body">
            <div class="leader-label p-0 text-center text-light bg-success">
              <span>Current Leader</span>
            </div>
            <div class="leader-name text-center bg-dark text-light my-1 p-1">
              <span
                th:if="${leader !=null}"
                class="h3 mt-1"
                th:text="${leader.name}"></span>
              <span th:unless="${leader !=null}" class="h3 mt-1"
                >No Leader</span
              >
            </div>
            <hr class="m-0 p-0 border border-secondary border-1 opacity-50" />
            <div
              th:if="${leader !=null}"
              class="d-flex justify-content-end mt-2 mb-0">
              <a type="button" id="changeLeaderButton" class="text-primary"
                ><span class="material-symbols-outlined">settings</span> Change
                Leader</a
              >
            </div>
          </div>
        </div>

        <div class="new-visitor card mt-5 mb-3">
          <div class="card-body">
            <button id="addVisitorButton" class="btn btn-dark">
              <span class="material-symbols-outlined">person_add</span> Create
              new visitor
            </button>
          </div>
        </div>

        <div id="appearanceTable" class="card mt-4 mb-4">
          <div class="p-1 mt-3 bg-dark">Appearance History</div>
          <div class="card-body">
            <table class="table" id="history">
              <thead>
                <tr>
                  <th scope="col">No</th>
                  <th scope="col">Date Issued</th>
                  <th scope="col">Name</th>
                  <th scope="col">Agency</th>
                  <th scope="col">Date Appeared</th>
                  <th scope="col">Purpose</th>
                </tr>
              </thead>
            </table>
          </div>
        </div>

        <!-- Add Visitor Modal -->
        <div
          class="modal"
          data-bs-theme="dark"
          id="addVisitorModal"
          role="dialog"
          tabindex="-1">
          <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title text-light">New Visitor</h5>
                <button
                  id="addModalCloseButton"
                  type="button"
                  class="btn-close"
                  data-bs-dismiss="modal"
                  aria-label="Close">
                  <span aria-hidden="true"></span>
                </button>
              </div>
              <form
                th:action="@{visitors/save}"
                method="POST"
                th:object="${addFormVisitorDTO}">
                <span
                  id="addModalMessageHolder"
                  th:text="${addModalMessage}"></span>
                <div class="modal-body ui-front">
                  <div class="col-xs-auto">
                    <!-- check for error -->
                    <div id="addModalDiv" th:if="${addModalMessage != null}">
                      <div class="alert alert-danger col-xs-auto">
                        <span th:text="${addModalMessage}"></span>
                      </div>
                    </div>
                  </div>
                  <div class="form-group">
                    <input type="hidden" th:field="*{id}" />

                    <div class="md-form form-floating mb-3">
                      <input
                        type="text"
                        th:field="*{name}"
                        class="form-control"
                        id="visitorName"
                        required
                        minlength="5"
                        maxlength="100"
                        placeholder="Name" />
                      <label class="text-secondary" for="visitorName"
                        >Name</label
                      >
                    </div>
                  </div>

                  <div class="form-group">
                    <div class="md-form form-floating mb-3">
                      <input
                        type="text"
                        th:field="*{position}"
                        class="form-control"
                        id="visitorPosition"
                        required
                        minlength="5"
                        maxlength="100"
                        placeholder="Position" />
                      <label class="text-secondary" for="visitorPosition"
                        >Position</label
                      >
                    </div>
                  </div>

                  <div class="form-group">
                    <div class="md-form form-floating mb-3">
                      <input
                        type="text"
                        th:field="*{agency}"
                        class="form-control"
                        id="visitorAgency"
                        required
                        minlength="5"
                        maxlength="100"
                        placeholder="Agency" />
                      <label class="text-secondary" for="visitorAgency"
                        >Agency</label
                      >
                    </div>
                  </div>
                </div>

                <div class="modal-footer">
                  <button
                    type="submit"
                    name="direction"
                    value="dashboard"
                    id="btnAdd"
                    class="btn btn-primary">
                    Save
                  </button>
                </div>
              </form>
            </div>
          </div>
        </div>

        <!-- Change Leader Modal -->
        <div
          th:if="${leader != null}"
          class="modal"
          data-bs-theme="dark"
          id="changeLeaderModal"
          role="dialog"
          tabindex="-1">
          <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title text-light">Change Leader</h5>
                <button
                  id="changeModalCloseButton"
                  type="button"
                  class="btn-close"
                  data-bs-dismiss="modal"
                  aria-label="Close">
                  <span aria-hidden="true"></span>
                </button>
              </div>
              <form
                th:action="@{/settings/leaders/changeLeader}"
                method="POST"
                enctype="multipart/form-data">
                <span
                  id="changeModalMessageHolder"
                  th:text="${changeModalMessage}"></span>
                <div class="modal-body ui-front">
                  <div class="col-xs-auto">
                    <!-- check for error -->
                    <div
                      id="changeModalDiv"
                      th:if="${changeModalMessage != null}">
                      <div class="alert alert-danger col-xs-auto">
                        <span th:text="${changeModalMessage}"></span>
                      </div>
                    </div>
                  </div>
                  <div class="form-group">
                    <div class="md-form form-floating mb-3">
                      <input
                        type="hidden"
                        name="leaderName"
                        th:value="${leader.name}"
                        id="currentLeaderName" />

                      <input
                        type="text"
                        name="name"
                        class="form-control"
                        id="leaderName"
                        required
                        minlength="5"
                        maxlength="100"
                        placeholder="Name" />
                      <label
                        id="nameLabel"
                        class="text-secondary"
                        for="leaderName"
                        >Name</label
                      >
                    </div>
                  </div>
                </div>

                <div class="modal-footer">
                  <button
                    type="submit"
                    name="direction"
                    value="leaders"
                    id="btnChange"
                    class="btn btn-primary">
                    Set
                  </button>
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>
    </div>

    <th:block layout:fragment="script">
      <script type="module" th:src="@{/js/dashboard.js}" defer></script>
    </th:block>
  </body>
</html>
