<!DOCTYPE html>
<html
  lang="en"
  xmlns:th="http://www.thymeleaf.org"
  xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
  xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
  layout:decorate="layout/layout"
  xmlns="http://www.w3.org/1999/html"
>
  <head>
    <title>Visitors</title>

    <link rel="stylesheet" th:href="@{/css/visitor.css}" />
  </head>
  <body>
    <div layout:fragment="content">
      <script th:inline="javascript">
        var positions = /*[[${positions}]]*/ "novalue";
        var agencies = /*[[${agencies}]]*/ "novalue";

        $(document).ready(function () {
          $("#visitorPosition").autocomplete({
            minLength: 1,
            source: positions,
          });

          $("#editVisitorPosition").autocomplete({
            minLength: 1,
            source: positions,
          });

          $("#visitorAgency").autocomplete({
            minLength: 1,
            source: agencies,
          });

          $("#editVisitorAgency").autocomplete({
            minLength: 1,
            source: agencies,
          });
        });
      </script>

      <div class="card">
        <div class="card-header pt-3">
          <div class="container text-center mt-6 pt-6">
            <div class="row justify-content-md-center mb-2">
              <div class="col-md-2 mt-1">
                <button
                  type="button"
                  id="addVisitorButton"
                  class="btn btn-sm btn-success"
                >
                  <span class="material-symbols-outlined">add</span>Add Visitor
                </button>
              </div>

              <div class="col-md-4">
                <form th:action="@{/visitors}" id="searchForm">
                  <div class="row">
                    <div class="col-8 p-0">
                      <input
                        id="searchName"
                        type="search"
                        name="searchName"
                        th:value="${searchName}"
                        placeholder="Enter keyword"
                        required
                        class="border border-secondary form-control"
                      />
                    </div>
                    <div class="col-auto p-1 mt-auto">
                      <button
                        type="submit"
                        class="btn-search btn btn-sm btn-primary"
                      >
                        <span class="material-symbols-outlined">search</span>
                      </button>
                    </div>
                  </div>
                </form>
              </div>
              <div class="col-md-1">
                <select
                  form="searchForm"
                  name="size"
                  th:value="${pageSize}"
                  id="pageSize"
                  class="border border-secondary form-control"
                >
                  <option
                    th:each="pageNum :${pageNums}"
                    th:value="${pageNum}"
                    th:text="${pageNum}"
                    th:selected="${pageNum == pageSize}"
                  ></option>
                </select>
              </div>

              <div class="btn-clear col-1 col-md-1 col-sm-1">
                <button id="btnClear" class="btn btn-sm btn-secondary">
                  Clear
                </button>
              </div>
            </div>
          </div>
        </div>

        <div class="card-body">
          <div th:if="${visitors.size() > 0}">
            <table class="table table-striped table-responsive-xl">
              <thead class="table-dark">
                <tr>
                  <th
                    th:replace="fragments/sorting :: sorting('/visitors', id, No)"
                  ></th>
                  <th
                    th:replace="fragments/sorting :: sorting('/visitors', name,Name)"
                  ></th>
                  <th
                    th:replace="fragments/sorting :: sorting('/visitors', position,Position)"
                  ></th>
                  <th
                    th:replace="fragments/sorting :: sorting('/visitors', agency,Agency)"
                  ></th>
                  <!-- <th th:replace="fragments/sorting :: sorting(agency.name,Last Appeared on)"></th> -->
                  <th scope="col">Actions</th>
                </tr>
              </thead>
              <tbody>
                <tr th:each="visitor : ${visitors}">
                  <th scope="row" th:text="${visitor.id}"></th>
                  <td th:text="${visitor.name}"></td>
                  <td th:text="${visitor.position}"></td>
                  <td th:text="${visitor.agency}"></td>
                  <td>
                    <!--                            <a type="button" class= "btn btn-sm btn-success" th:href="@{'/appearances/appearance-form/' + ${visitor.id}}" id="createAppearanceButton"-->
                    <!--                               title="New Appearance"><span class = "label-new">New</span></a>-->

                    <form
                      th:action="@{'/appearances/appearance-form/' + ${visitor.id}}"
                      method="GET"
                      id="createAppearance"
                    >
                      <button
                        type="submit"
                        class="btn btn-sm btn-success"
                        name="direction"
                        th:value="visitors"
                        title="New Appearance"
                      >
                        <span class="label-new">New</span>
                      </button>
                    </form>

                    <a
                      type="button"
                      title="Edit this visitor"
                      class="btn-edit btn btn-sm btn-warning"
                      th:visitorId="${visitor.id}"
                      th:visitorName="${visitor.name}"
                      th:visitorPosition="${visitor.position}"
                      th:visitorAgency="${visitor.agency}"
                    >
                      <span class="material-symbols-outlined">edit</span>
                    </a>

                    <!--                            <a type="button" sec:authorize="hasRole('ADMIN')" th:href="@{'/visitors/delete/' + ${visitor.id}}" th:visitorName="${visitor.name}"-->
                    <a
                      type="button"
                      th:href="@{'/visitors/delete/' + ${visitor.id}}"
                      th:visitorName="${visitor.name}"
                      title="Delete this visitor"
                      class="btn-delete btn btn-sm btn-danger"
                      ><span class="material-symbols-outlined">delete</span></a
                    >

                    <a
                      type="button"
                      th:href="@{/appearances/{id}/appearance-history(id=${visitor.id})}"
                      id="btnHistory"
                      title="Appearance History"
                      class="btn btn-sm btn-secondary"
                      ><span class="material-symbols-outlined"
                        >timeline</span
                      ></a
                    >
                  </td>
                </tr>
              </tbody>
            </table>
          </div>

          <div th:unless="${visitors.size() > 0}">
            <div class="no-record alert alert-dark text-center" role="alert">
              No records found
            </div>
          </div>
        </div>

        <div class="card-footer pt-3 pb-0">
          <!--Pagination-->
          <nav aria-label="Pagination" th:if="${totalPages > 0}">
            <ul class="pagination justify-content-center">
              <li
                class="page-item"
                th:classapend="${currentPage == 1} ? 'disabled'"
              >
                <a
                  th:replace="fragments/paging :: paging('/visitors', 1,'<<', 'First Page')"
                ></a>
              </li>

              <li
                class="page-item font-weight-bold"
                th:classappend="${currentPage == 1} ? 'disabled'"
              >
                <a
                  th:replace="fragments/paging :: paging('/visitors', ${currentPage - 1}, 'Prev','Previous Page')"
                ></a>
              </li>

              <li class="page-item disabled" th:if="${currentPage - 4 > 1}">
                <a class="page-link" href="#">...</a>
              </li>

              <li
                class="page-item"
                th:classappend="${page == currentPage} ? 'active'"
                th:each="page : ${#numbers.sequence(currentPage > 4 ? currentPage - 4 : 1, currentPage + 4 < totalPages ? currentPage + 4 : totalPages)}"
              >
                <a
                  th:replace="fragments/paging :: paging('/visitors', ${page}, ${page}, 'Page')"
                ></a>
              </li>

              <li
                class="page-item disabled"
                th:if="${currentPage + 4 < totalPages}"
              >
                <a class="page-link" href="#">...</a>
              </li>

              <li
                class="page-item"
                th:classappend="${currentPage == totalPages} ? 'disabled'"
              >
                <a
                  th:replace="fragments/paging :: paging('/visitors', ${currentPage + 1},'Next', 'Next Page')"
                ></a>
              </li>

              <li
                class="page-item"
                th:classappend="${currentPage == totalPages} ? 'disabled'"
              >
                <a
                  th:replace="fragments/paging :: paging('/visitors', ${totalPages}, '>>', 'Last Page')"
                ></a>
              </li>
            </ul>
          </nav>
        </div>
      </div>

      <!-- Add Visitor Modal -->
      <div
        class="modal"
        data-bs-theme="dark"
        id="addVisitorModal"
        role="dialog"
        tabindex="-1"
      >
        <div class="modal-dialog modal-dialog-centered" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title text-light">New Visitor</h5>
              <button
                id="addModalCloseButton"
                type="button"
                class="btn-close"
                data-bs-dismiss="modal"
                aria-label="Close"
              >
                <span aria-hidden="true"></span>
              </button>
            </div>
            <form
              th:action="@{visitors/save}"
              method="POST"
              th:object="${addFormVisitorDTO}"
              enctype="multipart/form-data"
            >
              <span
                id="addModalMessageHolder"
                th:text="${addModalMessage}"
              ></span>
              <div class="modal-body ui-front">
                <div class="col-xs-auto">
                  <!-- check for error -->
                  <div id="addModalDiv" th:if="${addModalMessage != null}">
                    <div class="alert alert-danger col-xs-auto">
                      <span th:text="${addModalMessage}"></span>
                    </div>
                  </div>
                </div>
                <div class="form-group">
                  <input type="hidden" th:field="*{id}" />

                  <div class="md-form form-floating mb-3">
                    <input
                      type="text"
                      th:field="*{name}"
                      class="form-control"
                      id="visitorName"
                      required
                      minlength="5"
                      maxlength="100"
                      placeholder="Name"
                    />
                    <label class="text-secondary" for="visitorName">Name</label>
                  </div>
                </div>

                <div class="form-group">
                  <div class="md-form form-floating mb-3">
                    <input
                      type="text"
                      th:field="*{position}"
                      class="form-control"
                      id="visitorPosition"
                      required
                      minlength="5"
                      maxlength="100"
                      placeholder="Position"
                    />
                    <label class="text-secondary" for="visitorPosition"
                      >Position</label
                    >
                  </div>
                </div>

                <div class="form-group">
                  <div class="md-form form-floating mb-3">
                    <input
                      type="text"
                      th:field="*{agency}"
                      class="form-control"
                      id="visitorAgency"
                      required
                      minlength="5"
                      maxlength="100"
                      placeholder="Agency"
                    />
                    <label class="text-secondary" for="visitorAgency"
                      >Agency</label
                    >
                  </div>
                </div>
              </div>

              <div class="modal-footer">
                <button
                  type="submit"
                  name="direction"
                  value="visitors"
                  id="btnAdd"
                  class="btn btn-primary"
                >
                  Save
                </button>
              </div>
            </form>
          </div>
        </div>
      </div>

      <!-- Edit Visitor Modal -->
      <div
        class="modal"
        data-bs-theme="dark"
        id="editVisitorModal"
        role="dialog"
        tabindex="-1"
      >
        <div class="modal-dialog modal-dialog-centered" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title text-light">Edit Visitor</h5>
              <button
                type="button"
                id="editModalCloseButton"
                class="btn-close"
                data-bs-dismiss="modal"
                aria-label="Close"
              >
                <span aria-hidden="true"></span>
              </button>
            </div>
            <form
              th:action="@{visitors/update}"
              method="POST"
              th:object="${editFormVisitorDTO}"
            >
              <span
                id="editModalMessageHolder"
                th:text="${editModalMessage}"
              ></span>

              <div class="modal-body ui-front">
                <div class="col-xs-auto">
                  <!-- check for error -->
                  <div id="editModalDiv" th:if="${editModalMessage != null}">
                    <div class="alert alert-danger col-xs-auto">
                      <span th:text="${editModalMessage}"></span>
                    </div>
                  </div>
                </div>
                <div class="form-group">
                  <input id="editVisitorId" type="hidden" th:field="*{id}" />

                  <div class="md-form form-floating mb-3">
                    <input
                      type="text"
                      th:field="*{name}"
                      class="form-control"
                      id="editVisitorName"
                      required
                      minlength="5"
                      maxlength="100"
                      placeholder="Name"
                    />
                    <label class="text-secondary" for="editVisitorName"
                      >Name</label
                    >
                  </div>
                </div>

                <div class="form-group">
                  <div class="md-form form-floating mb-3">
                    <input
                      type="text"
                      th:field="*{position}"
                      class="form-control"
                      id="editVisitorPosition"
                      required
                      minlength="5"
                      maxlength="100"
                      placeholder="Position"
                    />
                    <label class="text-secondary" for="editVisitorPosition"
                      >Position</label
                    >
                  </div>
                </div>

                <div class="form-group">
                  <div class="md-form form-floating mb-3">
                    <input
                      type="text"
                      th:field="*{agency}"
                      class="form-control"
                      id="editVisitorAgency"
                      required
                      minlength="5"
                      maxlength="100"
                      placeholder="Agency"
                    />
                    <label class="text-secondary" for="editVisitorAgency"
                      >Agency</label
                    >
                  </div>
                </div>
              </div>

              <div class="modal-footer">
                <button type="submit" id="btnEdit" class="btn btn-primary">
                  Save
                </button>
              </div>
            </form>
          </div>
        </div>
      </div>

      <!-- Delete Visitor Modal -->
      <div
        class="modal text-center"
        data-bs-theme="dark"
        id="deleteVisitorModal"
      >
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title text-light">Delete Confirmation</h5>
              <button
                type="button"
                class="btn-close"
                data-bs-dismiss="modal"
                aria-label="Close"
              >
                <!-- <span aria-hidden="true"></span> -->
              </button>
            </div>
            <div class="modal-body">
              <span id="confirmText" class="text-light"></span>
            </div>

            <div class="modal-footer">
              <a type="button" id="btnYes" class="btn btn-danger">Yes</a>
              <button
                type="button"
                class="btn btn-secondary"
                data-bs-dismiss="modal"
              >
                No
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <th:block layout:fragment="script">
      <script th:src="@{/js/visitor.js}" type="module" defer></script>
    </th:block>
  </body>
</html>
